---
title: Subjects With Common Adverse Events Occurring at â‰¥X% Frequency by Preferred Term, Safety Population, Pooled Analysis (or Trial X) 
subtitle: FDA Table 15
categories: [table, FDA, safety, adverse events]
---

::: panel-tabset
## Table Preview

```{r img, echo=FALSE, fig.align='center', out.width='60%'}
knitr::include_graphics("result.png")
```

## Setup

```{r setup, message=FALSE}
# Load libraries & data -------------------------------------
library(dplyr)
library(cards)
library(gtsummary)

adsl <- pharmaverseadam::adsl
adae <- pharmaverseadam::adae

# Pre-processing --------------------------------------------
adsl <- adsl |>
  filter(SAFFL == "Y") # safety population

data <- adae |>
  filter(
    # safety population
    SAFFL == "Y"
  )
```


## Build Table

```{r tbl, results = 'hide'}
tbl <-
  tbl_hierarchical(
    data,
    variables = c(AEDECOD),
    by = TRT01A,
    id = USUBJID,
    denominator = adsl,
    label = AEDECOD ~ "**Preferred Term**"
  ) |>
  # filter for >=5% frequency
  filter_hierarchical(sum(n) / sum(N) >= 0.05)

tbl
```

```{r eval=FALSE, include=FALSE}
# Run chunk locally to generate image file
gt::gtsave(as_gt(tbl), filename = "result.png")
```

```{r img, echo=FALSE, fig.align='center', out.width='60%'}
```

## Build ARD

```{r ard, message=FALSE, warning=FALSE, results='hide'}
ard <- gather_ard(tbl)
ard
```

```{r, echo=FALSE}
# Print full ARD
withr::local_options(width = 9999)
print(ard, columns = "all")
```

:::
