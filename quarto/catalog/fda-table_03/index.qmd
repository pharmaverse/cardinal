---
title: FDA Table 3
subtitle: Patient Screening and Enrollment, Trials A and B
categories: [table, FDA, safety, disposition]
---

::: panel-tabset
## Table Preview

```{r img, echo=FALSE, fig.align='center', out.width='60%'}
knitr::include_graphics("result.png")
```

## Setup

```{r setup, message=FALSE}
# Load libraries & data -------------------------------------
library(dplyr)
library(formatters)
library(cards)
library(gtsummary)

adsl <- random.cdisc.data::cadsl

set.seed(1)
adsl$RANDDT[sample(seq_len(nrow(adsl)), 100)] <- NA
scrnfail_reas_lvls <- c(
  "Inclusion/exclusion criteria not met", "Patient noncompliance", "Consent withdrawn", "Other"
)
adsl <- adsl %>%
  mutate(
    ENRLDT = RANDDT,
    SCRNFL = "Y",
    SCRNFRS = factor(sample(scrnfail_reas_lvls, size = nrow(adsl), replace = TRUE),
      levels = scrnfail_reas_lvls
    ),
    SCRNFAILFL = ifelse(is.na(ENRLDT), "Y", "N"),
    SCRNFL = with_label(SCRNFL == "Y", "Patients screened"),
    SCRNFL = with_label(!is.na(SCRNFRS), "Screnning failures"),
    ENRLFL = with_label(!is.na(ENRLDT), "Patients enrolled"),
    RANDFL = with_label(!is.na(RANDDT), "Patients randomized")
  )
adsl$SCRNFRS[adsl$SCRNFL == "N" | !is.na(adsl$ENRLDT)] <- NA
```

## Build ARD

```{r ard, message=FALSE, warning=FALSE, results='hide'}
ard <- adsl |>
  ard_stack(
    ard_dichotomous(
      variables = SCRNFL,
      value = list(SCRNFL = TRUE),
      statistic = everything() ~ c("n"),
      denominator = adsl
    ),
    ard_categorical(
      variables = SCRNFRS,
      statistic = everything() ~ c("n", "p")
    ),
    ard_dichotomous(
      variables = c(ENRLFL, RANDFL),
      value = list(ENRLFL = TRUE, RANDFL = TRUE),
      statistic = everything() ~ c("n", "p"),
      denominator = adsl
    )
  )

ard
```

```{r, echo=FALSE}
# Print ARD
withr::local_options(width = 9999)
print(ard, columns = "all", n = 40)
```

## Build Table

```{r tbl, message=FALSE, warning=FALSE}
tbl <- adsl %>%
  select("SCRNFL", "SCRNFRS", "ENRLFL", "RANDFL") %>%
  tbl_summary(
    statistic = SCRNFL ~ "{n}",
    label = list(
      SCRNFL ~ "Patients screened",
      SCRNFRS ~ "Screening failures"
    ),
    missing = "no"
  ) %>%
  modify_header(label = "**Disposition**", stat_0 = "**Trial A**") %>%
  remove_footnote_header(columns = everything())
```

```{r eval=FALSE, include=FALSE}
# Run chunk locally to generate image file
gt::gtsave(as_gt(tbl), filename = "result.png")
```

```{r img, echo=FALSE, fig.align='center', out.width='60%'}
```
:::
