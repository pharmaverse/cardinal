---
title: FDA Table 18
subtitle: Patients With Adverse Events by Female-Specific FDA Medical Query (Broad) and Preferred Term, Female Safety Population, Pooled Analyses
format: html
---

::: panel-tabset
## Spec. Screenshot

![](../assets/images/screenshots/table_18.png){fig-align="center"}

## Table

```{r tbl, message=FALSE, warning=FALSE}
# Load Libraries & Data
library(scda)
library(falcon)

adsl <- scda::synthetic_cdisc_dataset("rcd_2022_10_13", "adsl")
adae <- scda::synthetic_cdisc_dataset("rcd_2022_10_13", "adae")

# Pre-Processing - Ensure required variables FMQ01SC and FMQ01NAM exist in adae
set.seed(1)
adae <- dplyr::rename(adae, FMQ01SC = SMQ01SC, FMQ01NAM = SMQ01NAM)
levels(adae$FMQ01SC) <- c("BROAD", "NARROW")
adae$FMQ01SC[is.na(adae$FMQ01SC)] <- "NARROW"
adae$FMQ01NAM <- factor(adae$FMQ01NAM, levels = c(
  unique(adae$FMQ01NAM), "Abnormal Uterine Bleeding", "Amenorrhea",
  "Bacterial Vaginosis", "Decreased Menstrual Bleeding"
))
adae$FMQ01NAM[adae$SEX == "F"] <- as.factor(
  sample(c(
    "Abnormal Uterine Bleeding", "Amenorrhea",
    "Bacterial Vaginosis", "Decreased Menstrual Bleeding"
  ), sum(adae$SEX == "F"), replace = TRUE)
)

# Output Table
risk_diff <- list(arm_x = "B: Placebo", arm_y = "A: Drug X")
make_table_18(adae = adae, alt_counts_df = adsl, risk_diff = risk_diff)
```

## Table Setup

```{r tbl, eval=FALSE, echo=TRUE}
```

## Function Details

### `make_table_18()`

------------------------------------------------------------------------

Required variables:

-   **`adae`**: `adae` must contain `USUBJID`, `SEX`, and the variables
    specified by `arm_var`, `saffl_var`, `pref_var`, `fmqsc_var` and
    `fmqnam_var`.
-   **`alt_counts_df`** (if specified): `USUBJID` and the variables
    specified by `arm_var` and `saffl_var`.

+-------------+-----------------------------------------+-------------+
| Argument    | Description                             | Default     |
+:============+:========================================+:============+
| `adae`      | (`data.frame`) Dataset (typically ADAE) | *No         |
|             | required to build table.                | default*    |
+-------------+-----------------------------------------+-------------+
| `alt        | (`character`) Alternative dataset used  | `NULL`      |
| _counts_df` | only to calculate column counts.        |             |
+-------------+-----------------------------------------+-------------+
| `show       | (`flag`) Whether column counts should   | `TRUE`      |
| _colcounts` | be printed.                             |             |
+-------------+-----------------------------------------+-------------+
| `arm_var`   | (`character`) Arm variable used to      | `"ARM"`     |
|             | split table into columns.               |             |
+-------------+-----------------------------------------+-------------+
| `saffl_var` | (`character`) Flag variable used to     | `"SAFFL"`   |
|             | indicate inclusion in safety            |             |
|             | population.                             |             |
+-------------+-----------------------------------------+-------------+
| `pref_var`  | (`character`) Preferred term variable   | `"AEDECOD"` |
|             | to use in table.                        |             |
+-------------+-----------------------------------------+-------------+
| `sex_scope` | (`character`) Sex variable to use in    | `"F"`       |
|             | table.                                  |             |
+-------------+-----------------------------------------+-------------+
| `fmq_scope` | (`character`) FMQ scope value to use in | `"BROAD"`   |
|             | table.                                  |             |
+-------------+-----------------------------------------+-------------+
| `fmqsc_var` | (`character`) FMQ scope variable to use | `"FMQ01SC"` |
|             | in table.                               |             |
+-------------+-----------------------------------------+-------------+
| `           | (`character`) FMQ reference name        | `           |
| fmqnam_var` | variable to use in table.               | "FMQ01NAM"` |
+-------------+-----------------------------------------+-------------+
| `l          | (`character`) If specified, an overall  | `NULL`      |
| bl_overall` | column will be added to the table with  |             |
|             | the given value as the column label.    |             |
+-------------+-----------------------------------------+-------------+
| `risk_diff` | (named `list`) List of settings to      | `NULL`      |
|             | apply to add a risk difference column   |             |
|             | to the table. See                       |             |
|             | [tern::add_riskdiff()                   |             |
|             | ](https://insightsengineering.github.io |             |
|             | /tern/main/reference/add_riskdiff.html) |             |
|             | for more details. List should contain   |             |
|             | the following elements:                 |             |
|             |                                         |             |
|             | -   `arm_x`: (required) the name of     |             |
|             |     reference arm.                      |             |
|             |                                         |             |
|             | -   `arm_y`: (required) the name of the |             |
|             |     arm to compare to the reference     |             |
|             |     arm.                                |             |
|             |                                         |             |
|             | -   `col_label`: (optional) label to    |             |
|             |     use for the risk difference column. |             |
|             |     Defaults to                         |             |
|             |     `"Risk Difference (%) (95% CI)"`.   |             |
|             |                                         |             |
|             | -   `pct`: (optional) whether the       |             |
|             |     output should be returned as        |             |
|             |     percentages. Defaults to `TRUE`.    |             |
+-------------+-----------------------------------------+-------------+
| `prune_0`   | (`flag`) Whether all-zero rows should   | `FALSE`     |
|             | be removed from the table.              |             |
+-------------+-----------------------------------------+-------------+
| `na_level`  | (`character`) String to represent       | `"          |
|             | missing values.                         | <Missing>"` |
+-------------+-----------------------------------------+-------------+
| `a          | (named `list` of `character`) List of   | `NULL`      |
| nnotations` | annotations to add to the table. Valid  |             |
|             | annotation types are `title`,           |             |
|             | `subtitles`, `main_footer`, and         |             |
|             | `prov_footer.` Each name-value pair     |             |
|             | should use the annotation type as name  |             |
|             | and the desired string as value.        |             |
+-------------+-----------------------------------------+-------------+

Source code for this function is available
[here](https://github.com/pharmaverse/falcon/blob/main/R/fda-table_18.R).
:::
